<!DOCTYPE html><head><meta charset = "utf-8">
<title>3_Oct - HTMLFRIENDLY</title>

<style type = "text/css">
* {
  box-sizing: border-box;
}
div.sketch {
  position: relative;
}
.io-slider-box {
background-color: white; border: 1px solid gray; font-size:6px;
text-align: center; vertical-align: middle; line-height: 7px;
}
.io-slider-slide {
  padding: 0; margin: 0; -webkit-appearance: none; background: transparent;
}
.io-slider-slide::-ms-track {
  background: transparent; border-color: transparent; color: transparent;
}
.io-slider-slide::-webkit-slider-thumb {
  -webkit-appearance: none; width: 8px; height: 8px;
  border-radius: 20%; background: blue; cursor: pointer;
}
.io-slider-slide::-moz-range-thumb {
  height: 8px; width: 8px;
    border-radius: 20%; background: blue; cursor: pointer;
}
.io-slider-slide::-ms-thumb {
  height: 8px; width: 8px;
  border-radius: 20%; background: blue; cursor: pointer;
}
div.io-chart {
  background: white;
  border: 1px solid gray;
}
div.io-chart > .svg {
  width: 100%;
  height: 100%;
}
div.topBar * {
  display: inline-block;
}
h1, h3 {
  margin: 0 9px;
}
button.resetAll {
  padding: 12px 24px;
  text-align: center;
  font-size: 16px;
  margin: 12px;
}
button.exportCSV {
  padding: 12px 24px;
  text-align: center;
  font-size: 16px;
  margin: 12px;
}
</style>

<script type="text/javascript" src="mdl.js"></script>
<script type="text/javascript" src="vensim_wasm.js"></script>
<script type="text/javascript" src="wasm-arrays.min.js"></script>
<script type="text/javascript" src="d3.min.js"></script>
</head><body>
<h1>3_Oct - HTMLFRIENDLY</h1>

<div class="topBar">
<h3>powered by <a target="blank" href="https://vensim.com/">Vensim</a></h3>
<button class="resetAll">Reset All Sliders</button>
<button class="exportCSV">Export CSV</button>
</div>

<div class="sketch">
<img src="sketch.png"></img>
<div class="io-slider-box" name="time to adjust resources" style="position: absolute; top: 1118px; left: 1188px; width: 121px; height: 8px">
1
</div>
<input class="io-slider-slide" style="position: absolute; top: 1126px; left: 1188px; width: 121px" type="range" name="time to adjust resources" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="max work flow" style="position: absolute; top: 1092px; left: 1145px; width: 67px; height: 7px">
500
</div>
<input class="io-slider-slide" style="position: absolute; top: 1099px; left: 1145px; width: 67px" type="range" name="max work flow" min="-1000" max="2000" step="10"></input>
<div class="io-slider-box" name="scheduled completion date" style="position: absolute; top: 1236px; left: 1036px; width: 125px; height: 7px">
60
</div>
<input class="io-slider-slide" style="position: absolute; top: 1243px; left: 1036px; width: 125px" type="range" name="scheduled completion date" min="-100" max="200" step="1"></input>
<div class="io-slider-box" name="Baseline Funding" style="position: absolute; top: 1521px; left: 1199px; width: 81px; height: 7px">
250
</div>
<input class="io-slider-slide" style="position: absolute; top: 1528px; left: 1199px; width: 81px" type="range" name="Baseline Funding" min="-1000" max="2000" step="10"></input>
<div class="io-slider-box" name="Satellites Requested" style="position: absolute; top: 1294px; left: 1557px; width: 82px; height: 7px">
1000
</div>
<input class="io-slider-slide" style="position: absolute; top: 1301px; left: 1557px; width: 82px" type="range" name="Satellites Requested" min="-1000" max="2000" step="10"></input>
<div class="io-slider-box" name="Modularity Factor" style="position: absolute; top: 1304px; left: 1487px; width: 81px; height: 8px">
1
</div>
<input class="io-slider-slide" style="position: absolute; top: 1312px; left: 1487px; width: 81px" type="range" name="Modularity Factor" min="1" max="6" step="1"></input>
<div class="io-slider-box" name="Modularity Factor" style="position: absolute; top: 590px; left: 1117px; width: 81px; height: 8px">
1
</div>
<input class="io-slider-slide" style="position: absolute; top: 598px; left: 1117px; width: 81px" type="range" name="Modularity Factor" min="1" max="6" step="1"></input>
<div class="io-slider-box" name="Exogenous Technology and Process Halflife" style="position: absolute; top: 314px; left: 630px; width: 81px; height: 8px">
48
</div>
<input class="io-slider-slide" style="position: absolute; top: 322px; left: 630px; width: 81px" type="range" name="Exogenous Technology and Process Halflife" min="-100" max="200" step="1"></input>
<div class="io-slider-box" name="TIME STEP" style="position: absolute; top: 425px; left: 446px; width: 81px; height: 7px">
0.125
</div>
<input class="io-slider-slide" style="position: absolute; top: 432px; left: 446px; width: 81px" type="range" name="TIME STEP" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="start" style="position: absolute; top: 239px; left: 297px; width: 81px; height: 8px">
0
</div>
<input class="io-slider-slide" style="position: absolute; top: 247px; left: 297px; width: 81px" type="range" name="start" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="repeattime" style="position: absolute; top: 225px; left: 399px; width: 81px; height: 7px">
12
</div>
<input class="io-slider-slide" style="position: absolute; top: 232px; left: 399px; width: 81px" type="range" name="repeattime" min="-100" max="200" step="1"></input>
<div class="io-slider-box" name="end" style="position: absolute; top: 306px; left: 239px; width: 82px; height: 7px">
60
</div>
<input class="io-slider-slide" style="position: absolute; top: 313px; left: 239px; width: 82px" type="range" name="end" min="-100" max="200" step="1"></input>
<div class="io-slider-box" name="Updated Launch Time" style="position: absolute; top: 633px; left: 1296px; width: 81px; height: 8px">
0.25
</div>
<input class="io-slider-slide" style="position: absolute; top: 641px; left: 1296px; width: 81px" type="range" name="Updated Launch Time" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="Sats per LV" style="position: absolute; top: 624px; left: 1163px; width: 81px; height: 8px">
55
</div>
<input class="io-slider-slide" style="position: absolute; top: 632px; left: 1163px; width: 81px" type="range" name="Sats per LV" min="1" max="100" step="1"></input>
<div class="io-slider-box" name="Modularity Factor" style="position: absolute; top: 467px; left: 747px; width: 81px; height: 8px">
1
</div>
<input class="io-slider-slide" style="position: absolute; top: 475px; left: 747px; width: 81px" type="range" name="Modularity Factor" min="1" max="6" step="1"></input>
<div class="io-slider-box" name="Satellite Reliability" style="position: absolute; top: 667px; left: 2002px; width: 81px; height: 7px">
0.9
</div>
<input class="io-slider-slide" style="position: absolute; top: 674px; left: 2002px; width: 81px" type="range" name="Satellite Reliability" min="0" max="1" step="0.01"></input>
<div class="io-slider-box" name="Beta1" style="position: absolute; top: 576px; left: 2085px; width: 81px; height: 8px">
0.4154
</div>
<input class="io-slider-slide" style="position: absolute; top: 584px; left: 2085px; width: 81px" type="range" name="Beta1" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="Beta2" style="position: absolute; top: 533px; left: 2227px; width: 81px; height: 8px">
5.06
</div>
<input class="io-slider-slide" style="position: absolute; top: 541px; left: 2227px; width: 81px" type="range" name="Beta2" min="-10" max="20" step="0.1"></input>
<div class="io-slider-box" name="Theta1" style="position: absolute; top: 575px; left: 2138px; width: 81px; height: 8px">
558612
</div>
<input class="io-slider-slide" style="position: absolute; top: 583px; left: 2138px; width: 81px" type="range" name="Theta1" min="-1e+06" max="2e+06" step="10000"></input>
<div class="io-slider-box" name="Theta2" style="position: absolute; top: 557px; left: 2186px; width: 82px; height: 8px">
122.52
</div>
<input class="io-slider-slide" style="position: absolute; top: 565px; left: 2186px; width: 82px" type="range" name="Theta2" min="-1000" max="2000" step="10"></input>
<div class="io-slider-box" name="k" style="position: absolute; top: 512px; left: 2254px; width: 81px; height: 8px">
0.9057
</div>
<input class="io-slider-slide" style="position: absolute; top: 520px; left: 2254px; width: 81px" type="range" name="k" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="Design Life" style="position: absolute; top: 555px; left: 1368px; width: 82px; height: 7px">
24
</div>
<input class="io-slider-slide" style="position: absolute; top: 562px; left: 1368px; width: 82px" type="range" name="Design Life" min="8.40779e-45" max="200" step="1"></input>
<div class="io-slider-box" name="TIME STEP" style="position: absolute; top: 479px; left: 1555px; width: 82px; height: 8px">
0.125
</div>
<input class="io-slider-slide" style="position: absolute; top: 487px; left: 1555px; width: 82px" type="range" name="TIME STEP" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="TIME STEP" style="position: absolute; top: 639px; left: 1554px; width: 81px; height: 8px">
0.125
</div>
<input class="io-slider-slide" style="position: absolute; top: 647px; left: 1554px; width: 81px" type="range" name="TIME STEP" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="TIME STEP" style="position: absolute; top: 791px; left: 1527px; width: 81px; height: 8px">
0.125
</div>
<input class="io-slider-slide" style="position: absolute; top: 799px; left: 1527px; width: 81px" type="range" name="TIME STEP" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="TIME STEP" style="position: absolute; top: 550px; left: 1236px; width: 81px; height: 7px">
0.125
</div>
<input class="io-slider-slide" style="position: absolute; top: 557px; left: 1236px; width: 81px" type="range" name="TIME STEP" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="TIME STEP" style="position: absolute; top: 728px; left: 1197px; width: 81px; height: 7px">
0.125
</div>
<input class="io-slider-slide" style="position: absolute; top: 735px; left: 1197px; width: 81px" type="range" name="TIME STEP" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="Human Exp Decay Rate" style="position: absolute; top: 980px; left: 1278px; width: 82px; height: 8px">
24
</div>
<input class="io-slider-slide" style="position: absolute; top: 988px; left: 1278px; width: 82px" type="range" name="Human Exp Decay Rate" min="-100" max="200" step="1"></input>
<div class="io-slider-box" name="Baseline Funding Increase Ratio" style="position: absolute; top: 1490px; left: 1296px; width: 82px; height: 8px">
0.25
</div>
<input class="io-slider-slide" style="position: absolute; top: 1498px; left: 1296px; width: 82px" type="range" name="Baseline Funding Increase Ratio" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="Max Work Quality Possible" style="position: absolute; top: 901px; left: 1429px; width: 81px; height: 8px">
1
</div>
<input class="io-slider-slide" style="position: absolute; top: 909px; left: 1429px; width: 81px" type="range" name="Max Work Quality Possible" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="Minimum Work Quality Possible" style="position: absolute; top: 911px; left: 1524px; width: 81px; height: 8px">
0.25
</div>
<input class="io-slider-slide" style="position: absolute; top: 919px; left: 1524px; width: 81px" type="range" name="Minimum Work Quality Possible" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="Initial Work Quality Fraction" style="position: absolute; top: 1044px; left: 1474px; width: 81px; height: 8px">
0.34
</div>
<input class="io-slider-slide" style="position: absolute; top: 1052px; left: 1474px; width: 81px" type="range" name="Initial Work Quality Fraction" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="Exogenous Technology and Process Halflife" style="position: absolute; top: 1066px; left: 1650px; width: 81px; height: 8px">
48
</div>
<input class="io-slider-slide" style="position: absolute; top: 1074px; left: 1650px; width: 81px" type="range" name="Exogenous Technology and Process Halflife" min="-100" max="200" step="1"></input>
<div class="io-slider-box" name="Base Productivity Rate" style="position: absolute; top: 1232px; left: 945px; width: 82px; height: 8px">
1
</div>
<input class="io-slider-slide" style="position: absolute; top: 1240px; left: 945px; width: 82px" type="range" name="Base Productivity Rate" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name=""Policy: Ratio of Productivity Forced"" style="position: absolute; top: 1290px; left: 1356px; width: 81px; height: 7px">
1
</div>
<input class="io-slider-slide" style="position: absolute; top: 1297px; left: 1356px; width: 81px" type="range" name=""Policy: Ratio of Productivity Forced"" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="TIME STEP" style="position: absolute; top: 814px; left: 1014px; width: 81px; height: 8px">
0.125
</div>
<input class="io-slider-slide" style="position: absolute; top: 822px; left: 1014px; width: 81px" type="range" name="TIME STEP" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="Error Detection Tuning Variable" style="position: absolute; top: 1096px; left: 2049px; width: 82px; height: 8px">
250
</div>
<input class="io-slider-slide" style="position: absolute; top: 1104px; left: 2049px; width: 82px" type="range" name="Error Detection Tuning Variable" min="-1000" max="2000" step="10"></input>
<div class="io-slider-box" name="TIME STEP" style="position: absolute; top: 1035px; left: 1289px; width: 82px; height: 7px">
0.125
</div>
<input class="io-slider-slide" style="position: absolute; top: 1042px; left: 1289px; width: 82px" type="range" name="TIME STEP" min="-1" max="2" step="0.01"></input>
<div class="io-slider-box" name="Reduction Per Doubling of Experience" style="position: absolute; top: 1327px; left: 1007px; width: 81px; height: 8px">
0.15
</div>
<input class="io-slider-slide" style="position: absolute; top: 1335px; left: 1007px; width: 81px" type="range" name="Reduction Per Doubling of Experience" min="-1" max="2" step="0.01"></input>
<div class="io-chart" name="Test With Failure Rate Instead Current Sats in Space Total" varname='Test With Failure Rate Instead Current Sats in Space Total' xaxisname="Month" yaxisname="" include0 style="position: absolute; top: 565px; left: 2086px; width: 532px; height: 468px"></div>
<div class="io-chart" name="Surplus Money" varname='Surplus Money' xaxisname="Month" yaxisname="Dollars/Month" include0 style="position: absolute; top: 1231px; left: 458px; width: 391px; height: 237px"></div>
<div class="io-chart" name="Cumulative XP" varname='Cumulative XP' xaxisname="Month" yaxisname="" include0 style="position: absolute; top: 693px; left: 456px; width: 376px; height: 273px"></div>
<div class="io-chart" name="productivity rate" varname='productivity rate' xaxisname="Month" yaxisname="Tasks/(Dollars*Month)" include0 style="position: absolute; top: 967px; left: 461px; width: 378px; height: 257px"></div>
<div class="io-chart" name="NRE Pulse" varname='NRE Pulse' xaxisname="Month" yaxisname="Dmnl" include0 style="position: absolute; top: 137px; left: 706px; width: 426px; height: 162px"></div>
<div class="io-chart" name="Technology Value" varname='Technology Value' xaxisname="Month" yaxisname="Dmnl" include0 style="position: absolute; top: 668px; left: 67px; width: 379px; height: 311px"></div>
<div class="io-chart" name="Launch Rate" varname='Launch Rate' xaxisname="Month" yaxisname="" include0 style="position: absolute; top: 0px; left: 1339px; width: 304px; height: 212px"></div>
<div class="io-chart" name="Total Program Overruns in Tasks" varname='Total Program Overruns in Tasks' xaxisname="Month" yaxisname="Tasks" include0 style="position: absolute; top: 1469px; left: 443px; width: 404px; height: 252px"></div>
<div class="io-chart" name="work flow" varname='work flow' xaxisname="Month" yaxisname="Tasks/Month" include0 style="position: absolute; top: 1478px; left: 855px; width: 357px; height: 258px"></div>
<div class="io-chart" name="Work Remaining" varname='Work Remaining' xaxisname="Month" yaxisname="Tasks" include0 style="position: absolute; top: 1522px; left: 1219px; width: 345px; height: 239px"></div>
<div class="io-chart" name="Work Quality Stock" varname='Work Quality Stock' xaxisname="Month" yaxisname="" include0 style="position: absolute; top: 1531px; left: 1572px; width: 325px; height: 256px"></div>
<div class="io-chart" name="Undiscovered Rework" varname='Undiscovered Rework' xaxisname="Month" yaxisname="Tasks" include0 style="position: absolute; top: 1535px; left: 1898px; width: 292px; height: 251px"></div>
<div class="io-chart" name="Resources Available" varname='Resources Available' xaxisname="Month" yaxisname="Dollars" include0 style="position: absolute; top: 1310px; left: 2042px; width: 382px; height: 218px"></div>
</div>

<script type="text/javascript">

var VensimLoadedFlag = 0;

function OnVensimLoaded()
	{
		VensimLoadedFlag = _IsVensimLoaded();
		runModel(0);
	}


var VensimCharts = [];

function UpdateCharts(run)
	{
            var margin = {left: 70, right: 30, top: 30, bottom: 50};
			d3.selectAll("div.io-chart").each(function() {
				var div = d3.select(this);
				var width = parseInt(div.style("width"), 10);
				var height = parseInt(div.style("height"), 10);
				var temp = ["0", "0", width, height];
				div.selectAll("svg").data([0]).join("svg").attr("viewBox", temp.join(","));
				var chart = div.select("svg");
				var fTimeVals = GetSeries("Time");
                                var varname = div.attr("varname");
				var fVals = GetSeries(varname);
				if (!VensimCharts[varname]) {
					VensimCharts[varname] = { runs: [] };
				}
				var o = VensimCharts[varname];
				o.runs[run] = {
					times: fTimeVals,
					vals: fVals,
				}

				var vmin = Number.MAX_VALUE;
				var vmax = -Number.MAX_VALUE;
				for (r in o.runs) {
					vmin = Math.min(vmin, d3.min(o.runs[r].vals));
					vmax = Math.max(vmax, d3.max(o.runs[r].vals));
				}
				if ( this.hasAttribute("include0") ) { // force the range to include zero
					if (vmin > 0) vmin = 0;
					else if (vmax < 0) vmax = 0;
				}
				if ( this.hasAttribute("ymin") ) {
					vmin = this.getAttribute("ymin");
				}
				if ( this.hasAttribute("ymax") ) {
					vmax = this.getAttribute("ymax");
				}
				if ( vmin == vmax ) { // if the range is degenerate, modify
					if ( vmin == 0 ) {
						vmin = 0;
						vmax = 1;
					}
					else {
						vmin = vmax/2;
						vmax = vmax*2;
					}
				}
				
                chart.selectAll("text.title")
                  .data([0])
                  .join("text").attr("class", "title")
                  .attr("x", (width - margin.left - margin.right)/2 + margin.left)
                  .attr("y", (margin.top / 2))
                  .attr("text-anchor", "middle")
                  .style("font-size", "16px")
                  .text(div.attr("name"));
				  
                var xscale = d3.scaleLinear()
                    .domain([d3.min(fTimeVals), d3.max(fTimeVals)])
                    .range([margin.left, width - margin.right]);
                chart.selectAll("g.xaxis")
                  .data([0])
                  .join("g").attr("class", "xaxis")
                  .attr("transform", "translate(0, " + (height - margin.bottom) + ")")
                  .call(d3.axisBottom(xscale).ticks(width / 80).tickSizeOuter(0));
                chart.selectAll("text.xunits")
                  .data([0])
                  .join("text").attr("class", "xunits")
                  .attr("x", (width - margin.left - margin.right)/2 + margin.left)
                  .attr("y", height - 14)
                  .attr("text-anchor", "middle")
                  .style("font-size", "16px")
                  .text(div.attr("xaxisname"));
				  
                var yscale = d3.scaleLinear()
                    .domain([vmin, vmax])
                    .range([margin.top, height - margin.bottom]);
                var yscale_inv = d3.scaleLinear()
                    .domain([vmin, vmax])
                    .range([height - margin.bottom, margin.top]);
                chart.selectAll("g.yaxis")
                  .data([0])
                  .join("g").attr("class", "yaxis")
                  .attr("transform", "translate(" + margin.left + ", 0)")
                  .call(d3.axisLeft(yscale_inv));
                chart.selectAll("text.yunits")
                  .data([0])
                  .join("text").attr("class", "yunits")
                  .attr("transform", "rotate(-90)")
                  .attr("y", 16)
                  .attr("x", -(height - margin.top - margin.bottom)/2 - margin.top)
                  .attr("text-anchor", "middle")
                  .style("font-size", "16px")
                  .text(div.attr("yaxisname"));
				  
                for (r in o.runs) {
                    var color = "red";
                    if (r == 0) { color = "blue"; }
                    chart.selectAll("path.data" + r)
                      .data([o.runs[r].vals])
                      .join("path").attr("class", "data" + r).attr("d", (d, i) =>
                        d3.line()
                          .x((d, i) => xscale(o.runs[r].times[i]))
                          .y((d) => height - margin.bottom - yscale(d) + margin.top)(d))
                      .attr("stroke", color)
                      .attr("fill", "none");
                }
            });
}

// reset slider values to the value attribute in the io-slider-slide
function resetAllSliders() {
	d3.selectAll("input.io-slider-slide").nodes().forEach(function(i){
		i.value = i.getAttribute("value");
		d3.selectAll("div.io-slider-box[name=\"" + i.name + "\"]").text(i.valueAsNumber);
	});
}

// reset slider values to the value in the WASM code
function updateAllSliders() {
	d3.selectAll("input.io-slider-slide").nodes().forEach(function(i){
		i.value = GetConstant(i.name);
		d3.selectAll("div.io-slider-box[name=\"" + i.name + "\"]").text(i.valueAsNumber);
	});
}

// set slider values to the value in the WASM code and modify the DOM io-slider values to make that permanent
// if the value attribute is already defined, skip
// this permits the user to add value="37.5" to an io-slider-slider to override the WASM default
function initializeSliders() {
	d3.selectAll("input.io-slider-slide").nodes().forEach(function(i){
		var v;
		if ( i.hasAttribute("value")) {
			v = i.getAttribute("value");
		}
		else {
			v = GetConstant(i.name);
			i.setAttribute( "value", v);
		}
		// ensure that the property and text match the attribute
		i.value = v;
		d3.selectAll("div.io-slider-box[name=\"" + i.name + "\"]").text(i.valueAsNumber);
	});
}

firstRun = true;

function runModel(run) {
if (  VensimLoadedFlag == 0)
{
	return;
}
//if ( VensimLoadingFilesCount > 0)
//{
//	return;
//}

InitializeModel();
if (firstRun) {
	initializeSliders();
	firstRun = false;
}

// set all slider constants
d3.selectAll("input.io-slider-slide").each(function() {
	//console.log("Setting " + this.name + " to " + this.valueAsNumber);
	SetConstant(this.name, this.valueAsNumber);
});
RunSim();
UpdateCharts(run);
}

d3.select("button.resetAll").nodes()[0].onclick = function() {
resetAllSliders();
runModel(1);
}

d3.select("button.exportCSV").nodes()[0].onclick = function() {
ExportCSV();
}

d3.selectAll("input.io-slider-slide").nodes().forEach(function(i){
i.oninput = function() {
// update the number shown for all sliders of this var
d3.selectAll("div.io-slider-box[name=\"" + i.name + "\"]").text(i.valueAsNumber);
d3.selectAll("input.io-slider-slide[name=\"" + i.name + "\"]").each(function() { this.value = i.valueAsNumber; })
runModel(1);
};
});

</script>

</body></html>
